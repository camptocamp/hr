<?xml version="1.0" encoding="UTF-8"?>

<odoo>

    <record model="ir.ui.view" id="crm_case_form_view_oppor_bso">
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">
            <header position="inside">
                <button name="action_update_rates" string="Update Rates" type="object"/>
            </header>
            <xpath expr="//label[@for='planned_revenue']/ancestor::h2" position="before">
                <label for="currency_id" string="Opportunity currency"/>
                <field name="currency_id"/><br/>
                <h2 class="o_row">
                    <span>NRC:</span>
                    <field name="planned_revenue_nrc"/>
                    <span>+</span>
                    <span>MRC:</span>
                    <field name="planned_revenue_mrc"/>
                    <span>x</span><field name="planned_duration"/><span>months</span>
                    <span>=</span><span>TCV:</span>
                    <field name="planned_revenue_currency" class="oe_inline"/>
                </h2>
            </xpath>
            <xpath expr="//label[@for='planned_revenue']/ancestor::h2" position="inside">
                <!-- straight after the percent sign after the probability -->
                <span>, weighted TCV:</span>
                <field name="weighted_revenue"/>
            </xpath>
            <label for="planned_revenue" position="attributes">
                <attribute name="invisible">1</attribute>
            </label>
            <label for="probability" position="attributes">
              <attribute name="invisible">1</attribute>
            </label>
            <xpath expr="//field[@name='planned_revenue']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Marketing" name="marketing">
                    <group name="marketing">
                        <field name="industry_id"/>
                        <field name="industry_subsector_id"/>
                        <field name="status"/>
                        <field name="quick_title_id"/>
                        <field name="company_type"/>
                        <field name="size"/>
                    </group>
                </page>
                <page string="Consolidation">
                    <field name="currency_eur_id" invisible="1"/>
                    <field name="currency_usd_id" invisible="1"/>
                    <group>
                        <group name="revenues_eur" string="Revenues (EUR)">
                            <field name="planned_revenue_eur" string="TCV"/>
                            <field name="planned_revenue_nrc_eur" string="NRC"/>
                            <field name="planned_revenue_mrc_eur" string="MRC"/>
                            <field name="weighted_revenue_eur" string="Adj. TCV"/>
                        </group>
                        <group name="revenues_usd" string="Revenues (USD)">
                            <field name="planned_revenue_usd" string="TCV"/>
                            <field name="planned_revenue_nrc_usd" string="NRC"/>
                            <field name="planned_revenue_mrc_usd" string="MRC"/>
                            <field name="weighted_revenue_usd" string="Adj. TCV"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="crm_case_form_view_leads_bso" model="ir.ui.view">
        <field name="name">crm.lead.form.bso</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="options">{"create_edit": False, "no_open": True, "create_name_field": "name"}</attribute>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page string="Marketing" name="marketing">
                    <group name="marketing">
                        <field name="industry_id"/>
                        <field name="industry_subsector_id"/>
                        <field name="status"/>
                        <field name="quick_title_id"/>
                        <field name="company_type"/>
                        <field name="size"/>
                    </group>
                </page>
            </xpath>
            <xpath expr="//div[@name='button_box']/button[@name='toggle_active']" position="before">
                <field name="has_child_leads" invisible="1"/>
                <button name="action_view_opportunities"
                        type="object"
                        string="Opps.: "
                        class="oe_highlight oe_stat_button"
                        attrs="{'invisible': [('has_child_leads', '=', False)]}">
                    <span class="o_stat_value">NRC: <field name="sum_planned_revenue_nrc" widget="monetary"/> / MRC: <field name="sum_planned_revenue_mrc" widget="monetary" /></span>
                </button>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="crm_case_tree_view_oppor_bso">
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
        <field name="arch" type="xml">
            <field name="planned_revenue" position="attributes">
                <attribute name="invisible">True</attribute>
            </field>
            <field name="planned_revenue" position="before">
                <field name="planned_duration"/>
                <field name="display_planned_revenue_mrc" sum="total MRC"/>
                <field name="display_planned_revenue_nrc" sum="Total NRC"/>
                <field name="display_planned_revenue" sum="Total Revenue"/>
                <field name="display_weighted_tcv" sum="Total TCV"/>
                <field name="industry_id"/>
                <field name="industry_subsector_id"/>
                <field name="status"/>
                <field name="quick_title_id"/>
                <field name="company_type"/>
                <field name="size"/>
            </field>
        </field>
    </record>

    <record id="view_crm_case_opportunities_filter_bso" model="ir.ui.view">
        <field name="name">crm.lead.search</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='month']" position="after">
                <filter string="Industry" name="industry_id" domain="[]" context="{'group_by': 'industry_id'}" />
                <filter string="Industry subsector" name="industry_subsector_id" domain="[]" context="{'group_by': 'industry_subsector_id'}" />
                <filter string="Status" name="status" domain="[]" context="{'group_by': 'status'}" />
                <filter string="Quicktitle" name="quicktitle" domain="[]" context="{'group_by': 'quick_title_id'}" />
                <filter string="Company Type" name="company_type" domain="[]" context="{'group_by': 'company_type'}" />
                <filter string="Size" name="size" domain="[]" context="{'group_by': 'size'}" />
                <filter string="Country" name="country_id" domain="[]" context="{'group_by': 'country_id'}" />
            </xpath>
        </field>
    </record>

    <record id="crm_case_tree_view_leads_bso" model="ir.ui.view">
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="industry_id"/>
                <field name="industry_subsector_id"/>
                <field name="status"/>
                <field name="quick_title_id"/>
                <field name="company_type"/>
                <field name="size"/>
            </field>
        </field>
    </record>

    <record id="view_crm_case_leads_filter_bso" model="ir.ui.view">
        <field name="name">crm.lead.search</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='unassigned']" position="after">
                <filter string="Existing customers" name="existing_customer"
                        domain="[('partner_id', '!=', False)]"
                        help="Show only existing customers"/>
            </xpath>
            <xpath expr="//filter[@name='groupby_createmonth']" position="after">
                <filter string="Industry" name="industry_id" domain="[]" context="{'group_by': 'industry_id'}" />
                <filter string="Industry subsector" name="industry_subsector_id" domain="[]" context="{'group_by': 'industry_subsector_id'}" />
                <filter string="Status" name="status" domain="[]" context="{'group_by': 'status'}" />
                <filter string="Quicktitle" name="quicktitle" domain="[]" context="{'group_by': 'quick_title_id'}" />
                <filter string="Company Type" name="company_type" domain="[]" context="{'group_by': 'company_type'}" />
                <filter string="Size" name="size" domain="[]" context="{'group_by': 'size'}" />
                <filter string="Country" name="country_id" domain="[]" context="{'group_by': 'country_id'}" />
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="crm_case_kanban_view_oppor_bso">
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
        <field name="arch" type="xml">
            <field name="company_currency" position="after">
                <field name="currency_id" invisible="1"/>
                <field name="currency_usd_id" invisible="1"/>
                <field name="planned_duration"/>
                <field name="planned_revenue_nrc"/>
                <field name="planned_revenue_mrc"/>
            </field>
            <xpath expr="//field[@name='planned_revenue']//ancestor::div[hasclass('text-muted')]"
                   position="attributes">
              <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//div[@class='o_kanban_footer']" position="before">
                <div class="text-muted">
                    <t t-if="record.planned_duration.raw_value">
                        <field name="planned_duration"/>
                        <span>month(s)</span>
                    </t>
                </div>
                <div class="text-muted">
                    <t t-if="record.planned_revenue.raw_value">
                      <field name="planned_revenue_currency" widget="monetary"/>
                      | <field name="planned_revenue_usd" widget="monetary"
                             options="{'currency_field': 'currency_usd_id'}"/>
                      <span>TCV</span>
                    </t>
                </div>
                <div class="text-muted">
                    <t t-if="record.weighted_revenue.raw_value">
                      <field name="weighted_revenue" widget="monetary"/>
                      | <field name="weighted_revenue_usd" widget="monetary"
                             options="{'currency_field': 'currency_usd_id'}"/>
                      <span>Adjusted TCV</span>
                    </t>
                </div>
                <div class="text-muted">
                    <t t-if="record.planned_revenue_nrc.raw_value">
                        <field name="planned_revenue_nrc" widget="monetary"/>
                        | <field name="planned_revenue_nrc_usd" widget="monetary"
                                 options="{'currency_field': 'currency_usd_id'}"/>
                        <span>NRC</span>
                    </t>
                </div>
                <div class="text-muted">
                    <t t-if="record.planned_revenue_mrc.raw_value">
                        <field name="planned_revenue_mrc" widget="monetary"/>
                        | <field name="planned_revenue_mrc_usd" widget="monetary"
                                 options="{'currency_field': 'currency_usd_id'}"/>
                        <span>MRC</span>
                    </t>
                </div>
                <div class="text-muted">
                    <t t-if="record.date_deadline.raw_value">
                        <field name="date_deadline"/>
                        <span>- closing date</span>
                    </t>
                </div>
            </xpath>
        </field>
    </record>

    <record id="action_window_crm_marketing_lead" model="ir.actions.act_window">
        <field name="name">Leads</field>
        <field name="res_model">crm.lead</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('type', '=', 'lead')]</field>
        <field name="context">{'default_type': 'lead'}</field>
        <field name="search_view_id" ref="crm.view_crm_case_leads_filter"/>
    </record>

    <menuitem
        id="sales_marketing_menu" 
        name="Marketing"
        parent="sales_team.menu_base_partner" 
        sequence="1"/>

    <menuitem
        name="Leads"
        parent="sales_marketing_menu"
        action="action_window_crm_marketing_lead"
        id="menu_crm_marketing_lead"
        sequence="0"/>

</odoo>
