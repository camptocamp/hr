<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="bundle_details_epl_view" model="ir.ui.view">
        <field name="name">bundle.details.epl.form</field>
        <field name="model">bundle.details</field>
        <field name="inherit_id" ref="product_bundle.bundle_details_view"/>
        <field name="arch" type="xml">
            <xpath expr="//form/footer" position="before">
                <!--EPL LAYOUT-->
                <field name="epl_show" invisible="1"/>
                <div attrs="{'invisible': [('epl_show', '=', False)]}">
                    <field name="epl_bundle_id" invisible="1"/>
                    <group>
                        <field name="epl_a_pop"/>
                        <field name="epl_z_pop"/>
                        <field name="epl_optimize"/>
                    </group>
                    <group>
                        <field name="epl_protected"/>
                    </group>
                    <notebook>
                        <page string="ROUTE">
                            <group>
                                <field name="epl_route_latency"/>
                                <field name="epl_route_last_device"
                                       invisible="1"/>
                                <field name="epl_route"
                                       context="{'default_a_device_id': epl_route_last_device}"
                                       attrs="{'required': [('epl_show', '=', True)]}">
                                    <tree>
                                        <field name="sequence"
                                               widget="handle"/>
                                        <field name="link_id" invisible="1"/>
                                        <field name="a_device_id"/>
                                        <field name="z_device_id"/>
                                        <field name="latency"/>
                                    </tree>
                                    <form>
                                        <group>
                                            <field name="a_device_id"/>
                                            <field name="z_device_id"
                                                   attrs="{'readonly': [('a_device_id', '=', False)]}"/>
                                            <field name="link_id"
                                                   attrs="{'readonly': ['|', ('a_device_id', '=', False), ('z_device_id', '=', False)]}"/>
                                            <field name="latency"/>
                                        </group>
                                    </form>
                                </field>
                                <field name="epl_route_price_per_mb"
                                       invisible="1"/>
                                <field name="epl_route_cost_per_mb"
                                       invisible="1"/>
                            </group>
                        </page>
                        <page string="BACKUP"
                              attrs="{'invisible': [('epl_protected', '=', False)]}">
                            <group>
                                <field name="epl_backup_latency"/>
                                <field name="epl_backup_last_device"
                                       invisible="1"/>
                                <field name="epl_backup"
                                       context="{'default_a_device_id': epl_backup_last_device}}"
                                       attrs="{'required': [('epl_protected', '=', True)]}">
                                    <tree>
                                        <field name="sequence"
                                               widget="handle"/>
                                        <field name="link_id" invisible="1"/>
                                        <field name="a_device_id"/>
                                        <field name="z_device_id"/>
                                        <field name="latency"/>
                                    </tree>
                                    <form>
                                        <group>
                                            <field name="a_device_id"/>
                                            <field name="z_device_id"
                                                   attrs="{'readonly': [('a_device_id', '=', False)]}"/>
                                            <field name="link_id"
                                                   attrs="{'readonly': ['|', ('a_device_id', '=', False), ('z_device_id', '=', False)]}"/>
                                            <field name="latency"/>
                                        </group>
                                    </form>
                                </field>
                                <field name="epl_backup_price_per_mb"
                                       invisible="1"/>
                                <field name="epl_backup_cost_per_mb"
                                       invisible="1"/>
                            </group>
                        </page>
                    </notebook>
                    <group>
                        <field name="epl_description"
                               attrs="{'required': [('epl_show', '=', True)]}"/>
                    </group>
                    <group>
                        <field name="epl_bandwidth"
                               attrs="{'required': [('epl_show', '=', True)]}"/>
                        <field name="epl_price_per_mb" invisible="1"/>
                        <field name="epl_cost_per_mb" invisible="1"/>
                        <field name="epl_price"/>
                        <field name="epl_cost" invisible="1"/>
                    </group>
                    <group>
                        <field name="epl_bundle_categ_id" invisible="1"/>
                        <field name="epl_bundle_products">
                            <tree editable="bottom">
                                <field name="product_id"
                                       domain="[('categ_id', 'child_of', parent.epl_bundle_categ_id), ('is_bundle', '=', False)]"/>
                                <field name="product_quantity"/>
                                <field name="product_uom"/>
                                <field name="product_price"/>
                            </tree>
                        </field>
                        <field name="epl_bundle_price"/>
                        <field name="epl_bundle_price_per_mb" invisible="1"/>
                        <field name="epl_bundle_cost" invisible="1"/>
                        <field name="epl_bundle_cost_per_mb" invisible="1"/>
                    </group>
                    <group>
                        <field name="epl_total_price_per_mb" invisible="1"/>
                        <field name="epl_total_cost_per_mb" invisible="1"/>
                        <field name="epl_total_price"/>
                        <field name="epl_total_cost" invisible="1"/>
                    </group>
                </div>
            </xpath>
            <xpath expr="//form/footer/button[@name='button_cancel']"
                   position="before">
                <button name="button_epl_save"
                        string="Save EPL" type="object"
                        class="oe_highlight"
                        attrs="{'invisible': [('epl_show', '=', False)]}"/>
            </xpath>
        </field>
    </record>

</odoo>
