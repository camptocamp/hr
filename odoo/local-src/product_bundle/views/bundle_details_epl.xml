<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="bundle_details_epl_view" model="ir.ui.view">
        <field name="name">bundle.details.epl.form</field>
        <field name="model">bundle.details</field>
        <field name="inherit_id" ref="product_bundle.bundle_details_view"/>
        <field name="arch" type="xml">
            <xpath expr="//form/footer" position="before">
                <!--EPL LAYOUT-->
                <field name="show_epl" invisible="1"/>
                <div attrs="{'invisible': [('show_epl', '=', False)]}">
                    <notebook>
                        <page string="ROUTE">
                            <group>
                                <field name="epl_route"
                                       context="{'default_currency_id': sale_order_currency_id}">
                                    <tree>
                                        <field name="sequence"
                                               widget="handle"/>
                                        <field name="a_device_id"/>
                                        <field name="z_device_id"/>
                                        <field name="link_id" invisible="1"/>
                                        <field name="latency"/>
                                        <field name="is_protected"
                                               invisible="1"/>
                                        <field name="currency_id"
                                               invisible="1"/>
                                    </tree>
                                    <form>
                                        <group>
                                            <field name="sequence"
                                                   invisible="1"/>
                                            <field name="a_device_id"
                                                   domain="[('id', '=?', parent.epl_route_last_device)]"/>
                                            <field name="z_device_id"
                                                   attrs="{'readonly': [('a_device_id', '=', False)]}"/>
                                            <field name="link_id"
                                                   attrs="{'readonly': ['|', ('a_device_id', '=', False), ('z_device_id', '=', False)]}"
                                                   context="{'default_a_device_id': a_device_id, 'default_z_device_id': z_device_id}"/>
                                            <field name="latency"
                                                   invisible="1"/>
                                            <field name="is_protected"
                                                   invisible="1"/>
                                            <field name="currency_id"
                                                   invisible="1"/>
                                        </group>
                                    </form>
                                </field>
                                <field name="epl_route_last_device"
                                       invisible="1"/>
                                <field name="epl_route_latency"/>
                                <field name="epl_route_price_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_route_cost_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_route_price"
                                       widget="monetary"/>
                                <field name="epl_route_cost" widget="monetary"
                                       invisible="1"/>
                            </group>
                            <group>
                                <field name="epl_bandwidth"
                                       attrs="{'required': [('show_epl', '=', True)]}"/>
                                <field name="epl_bundle_name"
                                       attrs="{'required': [('show_epl', '=', True)]}"/>
                                <field name="epl_bundle_price_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_bundle_cost_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_bundle_price"
                                       widget="monetary"/>
                                <field name="epl_bundle_cost" widget="monetary"
                                       invisible="1"/>
                            </group>
                        </page>
                        <page string="BACKUP">
                            <group>
                                <field name="epl_backup"
                                       context="{'default_currency_id': sale_order_currency_id}">
                                    <tree>
                                        <field name="sequence"
                                               widget="handle"/>
                                        <field name="a_device_id"/>
                                        <field name="z_device_id"/>
                                        <field name="link_id" invisible="1"/>
                                        <field name="latency"/>
                                        <field name="is_protected"
                                               invisible="1"/>
                                        <field name="currency_id"
                                               invisible="1"/>
                                    </tree>
                                    <form>
                                        <group>
                                            <field name="sequence"
                                                   invisible="1"/>
                                            <field name="a_device_id"
                                                   domain="[('id', '=?', parent.epl_backup_last_device)]"/>
                                            <field name="z_device_id"
                                                   attrs="{'readonly': [('a_device_id', '=', False)]}"/>
                                            <field name="link_id"
                                                   attrs="{'readonly': ['|', ('a_device_id', '=', False), ('z_device_id', '=', False)]}"/>
                                            <field name="latency"
                                                   invisible="1"/>
                                            <field name="is_protected"
                                                   invisible="1"/>
                                            <field name="currency_id"
                                                   invisible="1"/>
                                        </group>
                                    </form>
                                </field>
                                <field name="epl_backup_last_device"
                                       invisible="1"/>
                                <field name="epl_backup_latency"/>
                                <field name="epl_backup_price_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_backup_cost_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_backup_price"
                                       widget="monetary"/>
                                <field name="epl_backup_cost" widget="monetary"
                                       invisible="1"/>
                            </group>
                        </page>
                        <page string="ADD PRODUCTS">
                            <group>
                                <field name="epl_products_bundle_id"
                                       invisible="1"/>
                                <field name="epl_products_bundle_categ_id"
                                       invisible="1"/>
                                <field name="epl_products"
                                       context="{'default_currency_id': sale_order_currency_id}">
                                    <tree editable="bottom">
                                        <field name="product_id"
                                               domain="[('categ_id', 'child_of', parent.epl_products_bundle_categ_id), ('is_bundle', '=', False)]"/>
                                        <field name="quantity"/>
                                        <field name="uom_id"/>
                                        <field name="price_per_unit"
                                               widget="monetary"/>
                                        <field name="currency_id"
                                               invisible="1"/>
                                    </tree>
                                </field>
                                <field name="epl_products_price"
                                       widget="monetary"/>
                                <field name="epl_products_cost"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_products_price_per_mb"
                                       widget="monetary" invisible="1"/>
                                <field name="epl_products_cost_per_mb"
                                       widget="monetary" invisible="1"/>
                            </group>
                        </page>
                        <page string="OPTIMAL PATH">
                            <group>
                                <field name="epl_optimal_pop_a"/>
                                <field name="epl_optimal_pop_z"/>
                                <field name="epl_optimal_optimize"/>
                                <field name="epl_optimal_protected"/>
                            </group>
                            <label for="button_epl_optimal_clicked"
                                   class="btn btn-sm btn-primary"/>
                            <field name="button_epl_optimal_clicked"
                                   invisible="1"/>
                        </page>
                    </notebook>
                </div>
            </xpath>
            <xpath expr="//form/footer/button[@name='button_cancel']"
                   position="before">
                <button name="button_epl_save"
                        string="Save EPL" type="object"
                        class="oe_highlight"
                        attrs="{'invisible': [('show_epl', '=', False)]}"/>
            </xpath>
        </field>
    </record>

</odoo>
