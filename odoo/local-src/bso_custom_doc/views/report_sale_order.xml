<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="paperformat_sale_order_custom" model="report.paperformat">
        <field name="name">paperformat sale order</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">40</field>
        <field name="margin_bottom">15</field>
        <field name="margin_left">0</field>
        <field name="margin_right">0</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">40</field>
        <field name="dpi">80</field>
    </record>

    <!-- assign custom paperformat to SO report -->
    <record id="sale.report_sale_order" model="ir.actions.report.xml">
        <field name="paperformat_id"
               ref="bso_custom_doc.paperformat_sale_order_custom"/>
    </record>

    <!-- second part of SO report wrapped by custom header/footer-->
    <template id="second_page_so">
        <t t-call="bso_custom_doc.external_layout_custom_second_page">
            <t t-set="doc"
               t-value="doc.with_context({'lang':doc.partner_id.lang})"/>
            <div class="page">
                <t t-if="doc.product_category_id.terms_text">
                    <h1>
                        <span t-field="doc.product_category_id.terms_title"/>
                    </h1>
                    <div class="terms-text">
                        <span t-field="doc.product_category_id.terms_text"/>
                    </div>
                </t>
                <div class="box">
                    <h3>Notes:</h3>
                    <h5 t-if="doc.validity_date">Expiration date:
                        <span t-field="doc.validity_date"/>
                    </h5>
                    <h5>Additional Technical Information :</h5>
                    <t t-if="doc.note">
                        <span t-field="doc.note"/>
                    </t>
                    <t t-else="">
                        <hr class="dashed-line"/>
                        <hr class="dashed-line"/>
                        <hr class="dashed-line"/>
                        <hr class="dashed-line"/>
                        <hr class="dashed-line"/>
                        <hr class="dashed-line"/>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- inherit and add css style -->
    <template id="custom_layout_inherit" inherit_id="report.minimal_layout">
        <xpath expr="//head" position="inside">
            <link rel='stylesheet'
                  href="/bso_custom_doc/static/src/css/style.css"/>
        </xpath>
    </template>

    <template id="report_saleorder_document_inherit_sale_stock_bso"
              inherit_id="sale_stock.report_saleorder_document_inherit_sale_stock">
        <xpath expr="//div[@name='payment_term']" position="replace">
        </xpath>
    </template>

    <template id="report_shop_saleorder_document_bso"
              inherit_id="website_sale.report_shop_saleorder_document">
        <xpath expr="//div[@name='total']" position="replace">
        </xpath>
    </template>

    <template id="report_sale_payment_mode_bso"
              inherit_id="account_payment_sale.report_sale_payment_mode">
        <xpath expr="//p[@t-if='doc.payment_mode_id.note']" position="replace">
        </xpath>
    </template>

    <template id="report_saleorder_validity_date_bso"
              inherit_id="website_quote.report_saleorder_validity_date">
        <xpath expr="//div[@id='informations']" position="replace">
            <div class="box">
                <div class="row">
                    <div class="col-xs-12">
                        <h3>
                            Contract Details:
                        </h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-6">

                        <div t-if="doc.partner_id.ref">
                            <strong>Governing MSA:</strong>
                            <span t-field="doc.partner_id.ref"/>
                        </div>
                        <div t-if="doc.client_order_ref">
                            <strong>Customer Reference:</strong>
                            <span t-field="doc.client_order_ref"/>
                        </div>
                        <div t-if="doc.duration">
                            <strong>Duration:</strong>
                            <span t-field="doc.duration"/>
                            Months
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div name="payment_term"
                             t-if="doc.payment_term_id">
                            <strong>Payment Terms:</strong>
                            <span t-field="doc.payment_term_id"/>
                        </div>
                        <div name="currency"
                             t-if="doc.currency_id">
                            <strong>Currency:</strong>
                            <span t-field="doc.pricelist_id.currency_id"/>
                        </div>
                        <div name="delivery_date"
                             t-if="doc.estimated_delivery_date">
                            <strong>Estimated delivery date:</strong>
                            <span t-field="doc.estimated_delivery_date"/>
                            days
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//p[@id='fiscal_position_remark']" position="replace">
        </xpath>
    </template>

    <template id="report_saleorder_bso"
              inherit_id="sale.report_saleorder_document">
        <xpath expr="//t[@t-call='report.external_layout']"
               position="attributes">
            <attribute name="t-call">bso_custom_doc.external_layout_custom_first_page</attribute>
        </xpath>
        <xpath expr="//h2" position="replace">
        </xpath>
        <xpath expr="//div[@class='row']" position="replace">
            <div class="container">
                <div class="col-xs-5 box pull-left">
                    <h3 t-if="doc.partner_invoice_id">
                        Customer:
                    </h3>
                    <span t-field="doc.partner_invoice_id"
                          t-field-options='{"widget": "contact", "fields": ["name", "address"], "no_marker": true}'/>
                    <t t-if="doc.partner_invoice_id.vat">Registration number:
                        <span t-field="doc.partner_invoice_id.vat"/>
                    </t>
                </div>
                <div class="col-xs-2">
                </div>
                <div class="col-xs-5 pull-right box">
                    <h3 t-if="doc.partner_shipping_id">
                        Invoicing Address:
                    </h3>
                    <span t-field="doc.partner_shipping_id"
                          t-field-options='{"widget": "contact", "fields": ["name", "address"], "no_marker": true}'/>
                    <t t-if="doc.partner_shipping_id.vat">VAT :
                        <span t-field="doc.partner_shipping_id.vat"/>
                    </t>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@class='oe_structure']" position="replace">
            <div class="row">
                <h2 class="text-center">
                    <span t-if="doc.state not in ['draft','sent']">
                        Order #
                    </span>
                    <span t-if="doc.state in ['draft','sent']">
                        Quotation #
                    </span>
                    <span t-field="doc.name"/>
                </h2>
            </div>
        </xpath>
        <xpath expr="//div[@name='total']"
               position="after">
            <div class="box">
                <div class="row">
                    <div class="col-xs-12">
                        <h3>
                            Signatures:
                        </h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-6">
                        <h5>
                            <span t-field="doc.partner_id"></span>
                        </h5>
                    </div>
                    <div class="col-xs-6">
                        <h5>BSO</h5>
                    </div>
                </div>
                <div class="row custom-height">
                    <div class="col-xs-2">
                        <h5>Signature:</h5>
                        <h5>Printed name:</h5>
                        <h5>Date:</h5>
                        <h5>Title:</h5>
                    </div>
                    <div class="col-xs-4">
                        <hr></hr>
                        <hr></hr>
                        <hr></hr>
                        <hr></hr>
                    </div>
                    <div class="col-xs-2">
                        <h5>Signature:</h5>
                        <h5>Printed name:</h5>
                        <h5>Date:</h5>
                        <h5>Title:</h5>
                    </div>
                    <div class="col-xs-4">
                        <hr></hr>
                        <hr></hr>
                        <hr></hr>
                        <hr></hr>
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//table[@class='table table-condensed']/thead/tr/th[5]"
               position="replace">
        </xpath>
        <xpath expr="//table[@class='table table-condensed']/tbody//t[@t-foreach='page']//t[2]/tr/td[5]"
               position="replace">
        </xpath>
        <xpath expr="//table[@class='table table-condensed']/tbody//t[@t-foreach='page']//t[2]/tr/td/span[@t-field='l.product_uom_qty']"
               position="replace">
            <span t-esc="'{:,.2f}'.format(l.product_uom_qty)"/>
        </xpath>
        <xpath expr="//table[@class='table table-condensed']"
               position="after">
            <div class="row box-total">
                <div class="col-xs-9 custom-padding">
                    <strong>Taxes Not included</strong>
                </div>
                <div class="col-xs-3 custom-padding pull-right">
                    <table class="table box-nrc-mrc">
                        <tr align="right">
                            <td>
                                <strong>NRC:</strong>
                            </td>
                            <td class="text-right">
                                <span t-field="doc.amount_nrc"
                                      t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                            </td>
                        </tr>
                        <tr align="right">
                            <td>
                                <strong>MRC:</strong>
                            </td>
                            <td class="text-right">
                                <span t-field="doc.amount_mrc"
                                      t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </xpath>
        <xpath expr="//table[@class='table table-condensed']"
               position="attributes">
            <attribute name="class">table table-condensed services</attribute>
        </xpath>
        <xpath expr="//p[@t-field='doc.note']" position="replace">
        </xpath>
        <xpath expr="//span[@t-field='doc.payment_term_id.note']"
               position="replace">
        </xpath>
    </template>
    <!-- inherit and add second part of SO -->
    <template id="report_saleorder_parent"
              inherit_id="sale.report_saleorder">
        <xpath expr="//t[@t-foreach='docs']" position="inside">
            <t t-call="bso_custom_doc.second_page_so"/>
        </xpath>
    </template>

</odoo>